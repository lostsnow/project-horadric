<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="zh-CN" />
<meta name="Keywords" content="" />
<meta name="Description" content="" />
<title>jsonp</title>
<script type="text/javascript">
var Runeword = {};
Runeword.jsonp = function(fn){
    var d = (new Date).getTime();
    //translate callback function
    var jsonp = "jsonp" + d++;
    window[ jsonp ] = function(tmp){
        fn.callback(tmp);
        window[ jsonp + "done" ] = true;
    }

    setTimeout(function(){
        if (!window[ jsonp + "done" ]) {
            fn.error();
        }
        try{document.body.removeChild(script);} catch(e){}

        // Garbage collect
        window[ jsonp ] = undefined;
        try{ delete window[ jsonp ]; } catch(e){}
        window[ jsonp + "done" ] = undefined;
        try{ delete window[ jsonp + "done" ]; } catch(e){}
    }, 200);

    //tell server the callback method
    fn.url = fn.url + "&callback=" + jsonp + '&';

    //creat script
    var head = document.getElementsByTagName("head")[0];
    var script = document.createElement("script");
    script.setAttribute("src", fn.url);
    script.setAttribute("type", "text/javascript");

    //after script loaded,we remove the script
    script.onload = script.onreadystatechange = function(){
        if (!this.readyState || this.readyState == "loaded" ||
            this.readyState == "complete") {
            setTimeout(function(){
                head.removeChild(script);
            }, 50);
        }
    };

    //insert script
    head.appendChild(script);
};

Runeword.ready = function(f){
    var ie  = !!(window.attachEvent && !window.opera);
    var wk  = /webkit\/(\d+)/i.test(navigator.userAgent) && (RegExp.$1 < 525);
    var fn  = [];
    var run = function () { for (var i = 0; i < fn.length; i++) fn[i](); };
    var d   = document;

    if (!ie && !wk && d.addEventListener)
        return d.addEventListener('DOMContentLoaded', f, false);
    if (fn.push(f) > 1) return;
    if (ie)
        (function(){
            try { d.documentElement.doScroll('left'); run(); }
            catch (err) { setTimeout(arguments.callee, 0); }
        })();
    else if (wk)
        var t = setInterval(function () {
            if (/^(loaded|complete)$/.test(d.readyState))
                clearInterval(t), run();
        }, 0);
};

Runeword.ready(function(){
    var jsonp = document.getElementById('jsonp');

    jsonp.onclick = function(){
        Runeword.jsonp({
//            url:'http://www.biemai.com/php/demo/json/jsonp.php?',
            url:'http://192.168.128.128/ad.php?m[]=qwer&m[]=asdf&m[]=zxcv',
            callback: function(res){
                if (res) {
                    if (res.status == true) {
                        alert('ad_id: ' + res.ad_id);
                    } else {
                        alert('default');
                    }

                } else {
                    alert('error');
                }
            },
            error: function(res){
                alert('404error');
            }
        });
    };
});
</script>
</head>
<body>
<input id="jsonp" type="submit" />
</body>
</html>